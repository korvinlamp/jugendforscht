<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sanit√§ter & Erste Hilfe</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      text-align: center;
      padding: 30px;
      font-size: 20px;
    }

    .hidden {
      display: none;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      margin: auto;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
      color: #dc3545;
      font-size: 26px;
      margin-bottom: 20px;
    }

    input,
    button {
      font-size: 20px;
      padding: 14px;
      margin: 12px auto;
      width: 90%;
      max-width: 350px;
    }

    button {
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .btn-red {
      background-color: #dc3545;
      color: white;
    }

    .btn-red:hover {
      background-color: #c82333;
    }

    .btn-yellow {
      background-color: #ffc107;
      color: black;
    }

    .btn-yellow:hover {
      background-color: #e0a800;
    }

    .btn-gray {
      background-color: #6c757d;
      color: white;
    }

    #response {
      font-size: 24px;
      font-weight: bold;
      color: green;
      margin-top: 25px;
    }

    #warning {
      font-size: 18px;
      color: #6c757d;
      margin-top: 10px;
    }

    p {
      font-size: 20px;
      line-height: 1.5;
    }

    ul {
      text-align: left;
      display: inline-block;
      font-size: 20px;
      padding-left: 0;
      margin: 20px 0;
      list-style: none;
    }

    ul li::before {
      content: "üî∏ ";
    }

    .section {
      margin-top: 25px;
    }

    .led {
      width: 100%;
      max-width: 300px;
      height: 80px;
      margin: 20px auto;
      border-radius: 20px;
      background-color: gray;
      transition: background-color 0.05s ease-in-out;
    }

    .led.active {
      background-color: red;
    }

    #timerDisplay {
      font-size: 28px;
      margin-top: 20px;
    }

    .blink {
      color: red;
      font-weight: bold;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <div id="alarm-section" class="container">
    <h2>üö® Sanit√§ter Alarmieren</h2>
    <form id="alarmForm">
      <label for="raum">Raum:</label><br />
      <input type="text" id="raum" placeholder="z. B. N01" required /><br />
      <button type="submit" class="btn-red">üö® Alarm senden</button>
    </form>
    <p id="response"></p>
    <p id="warning" class="hidden">Dies ersetzt nicht den Notruf 112!</p>
    <div class="section hidden" id="hilfeStartBtn">
      <button class="btn-yellow" onclick="showAnleitung('eigenschutz')">‚õëÔ∏è Erste Hilfe Anleitung</button>
    </div>
  </div>

  <div id="anleitung-section" class="container hidden">
    <div id="anleitung-content"></div>
    <div id="led" class="led hidden"></div>
  </div>

  <script>
    const steps = {
      eigenschutz: {
        title: "üë∑‚Äç‚ôÇÔ∏è Eigenschutz geht vor!",
        points: ["Eigenes Umfeld pr√ºfen", "Gefahr f√ºr dich ausschlie√üen", "Erst dann helfen!"],
        next: "reaktion"
      },
      reaktion: {
        title: "ü§î Reagiert die Person?",
        points: ["Ansprechen & sanft anfassen"],
        nextOptions: [
          { label: "‚úÖ Ja", next: "ersthilfe" },
          { label: "‚ùå Nein", next: "atmung-vorbereitung" }
        ]
      },
      ersthilfe: {
        title: "üü¢ Person reagiert",
        points: [
          "Lebensbedrohliche Verletzungen versorgen",
          "112 anrufen (falls n√∂tig)",
          "W√§rmen & betreuen"
        ]
      },
      "atmung-vorbereitung": {
        title: "üëÉ Atmung pr√ºfen (10 Sek.)",
        points: [
          "Person liegt auf R√ºcken",
          "Kopf √ºberstrecken",
          "Oberk√∂rper frei machen"
        ],
        nextOptions: [
          { label: "‚úÖ Atmet", next: "seitenlage" },
          { label: "‚ùå Keine Atmung", next: "keinatmung-notruf" }
        ]
      },
      seitenlage: {
        title: "üõèÔ∏è Stabile Seitenlage",
        points: [
          "Person liegt seitlich",
          "Kopf √ºberstreckt",
          "Mundwinkel tiefster Punkt"
        ],
        next: "seitenlage-notruf"
      },
      "seitenlage-notruf": {
        title: "üìû Notruf 112 & AED holen",
        points: [
          "Andere Personen um Hilfe bitten",
          "Bei der Person bleiben"
        ],
        next: "atmung-wiederholen"
      },
      "atmung-wiederholen": {
        title: "‚è≥ Atmung regelm√§√üig pr√ºfen",
        points: ["Alle 2:30 Minuten pr√ºfen!"],
        timer: 150,
        nextOptions: [{ label: "Atmung jetzt pr√ºfen", next: "atmung-vorbereitung" }]
      },
      "keinatmung-notruf": {
        title: "üìû Notruf 112 & AED holen",
        points: [
          "Sofort Hilfe holen lassen",
          "Dann mit Reanimation beginnen"
        ],
        next: "reanimation"
      },
      reanimation: {
        title: "‚ù§Ô∏è Wiederbelebung starten",
        points: [
          "30x Brustkorb kr√§ftig dr√ºcken",
          "2x beatmen: Kopf √ºberstrecken, Nase zuhalten",
          "Im Wechsel: 30:2 ‚Äì bis Hilfe kommt"
        ],
        showMetronome: true
      }
    };

    let historyStack = [];
    let metronomeInterval = null;
    let timerInterval = null;
    let timerTimeout = null;

    const led = document.getElementById("led");

    function showSection() {
      document.getElementById("alarm-section").classList.add("hidden");
      document.getElementById("anleitung-section").classList.remove("hidden");
    }

    function showAnleitung(key) {
      showSection();
      const step = steps[key];
      if (!step) return;

      clearTimers();

      if (historyStack[historyStack.length - 1] !== key) {
        historyStack.push(key);
      }

      let html = `<h2>${step.title}</h2>`;
      if (step.points) {
        html += "<ul>";
        step.points.forEach(p => html += `<li>${p}</li>`);
        html += "</ul>";
      }

      if (step.timer) {
        html += `<p id="timerDisplay">‚è≥ 2:30</p>`;
        startCountdown("timerDisplay", step.timer);
      }

      if (step.showMetronome) {
        html += `<button class="btn-yellow" onclick="toggleMetronome(this)">üïí Takt starten</button>`;
        led.classList.remove("hidden");
      } else {
        led.classList.add("hidden");
      }

      if (step.next) {
        html += `<button class="btn-yellow" onclick="showAnleitung('${step.next}')">Weiter</button>`;
      } else if (step.nextOptions) {
        step.nextOptions.forEach(opt => {
          html += `<button class="btn-yellow" onclick="showAnleitung('${opt.next}')">${opt.label}</button>`;
        });
      }

      if (historyStack.length > 1) {
        html += `<br><button class="btn-gray" onclick="goBack()">‚Ü©Ô∏è Zur√ºck</button>`;
      }

      document.getElementById("anleitung-content").innerHTML = html;
    }

    function goBack() {
      if (historyStack.length > 1) {
        historyStack.pop();
        const previous = historyStack.pop();
        showAnleitung(previous);
      }
    }

    function startCountdown(id, seconds) {
      let time = seconds;
      const display = document.getElementById(id);

      display.textContent = `‚è≥ 2:30`;

      timerInterval = setInterval(() => {
        time--;
        const m = Math.floor(time / 60);
        const s = time % 60;
        display.textContent = `‚è≥ ${m}:${s.toString().padStart(2, '0')}`;
      }, 1000);

      timerTimeout = setTimeout(() => {
        clearInterval(timerInterval);
        display.innerHTML = `<span class="blink">‚ÄºÔ∏è Atmung jetzt erneut pr√ºfen!</span>`;
      }, seconds * 1000);
    }

    function toggleMetronome(btn) {
      if (metronomeInterval) {
        clearInterval(metronomeInterval);
        metronomeInterval = null;
        led.classList.remove("active");
        btn.textContent = "üïí Takt starten";
        return;
      }

      btn.textContent = "‚èπÔ∏è Takt stoppen";
      metronomeInterval = setInterval(() => {
        led.classList.add("active");
        setTimeout(() => {
          led.classList.remove("active");
        }, 100);
      }, 545);
    }

    function clearTimers() {
      if (timerInterval) clearInterval(timerInterval);
      if (timerTimeout) clearTimeout(timerTimeout);
      if (metronomeInterval) clearInterval(metronomeInterval);
      metronomeInterval = null;
      led.classList.remove("active");
    }

    document.getElementById("alarmForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const raum = document.getElementById("raum").value;
      const url = "https://maker.ifttt.com/trigger/sanitaeter-alarm/with/key/cCSCnLcOR4Lqjv_YDsEOYr?value1=" + encodeURIComponent(raum);
      fetch(url).finally(() => {
        document.getElementById("alarmForm").style.display = "none";
        document.getElementById("response").innerText = "‚úÖ Sanit√§ter sind alarmiert!";
        document.getElementById("warning").classList.remove("hidden");
        document.getElementById("hilfeStartBtn").classList.remove("hidden");
      });
    });
  </script>
</body>
</html>
